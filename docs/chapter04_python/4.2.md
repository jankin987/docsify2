# 4.2 使用python整理跟踪的数据集

## 4.2.1 使用python整理OTB100
### 1.获取一个路径下所有的文件夹
```python
from os.path import exists, isdir, basename, join, splitext
from glob import glob

def get_dirs(path,fullname=True):
    all_dirs=[files for files in glob(path+'/*') if isdir(files)]
    all_dirs.sort()
    if fullname ==True:
        return all_dirs
    else:
        all_dirnames= [basename(dir_) for dir_ in all_dirs]
        return all_dirnames
        
 otbSeqDirFullname=get_dirs(path,True) #返回完整路径 
 otbSeqDirBasename=get_dirs(path,False) #只返回名称
```

### 2.获取otb每个序列图片个数
```python
for item in otbSeqDirFullname:
    pics=glob(join(item,'img\*.jpg'))
    print(basename(item),":",len(pics))
```

### 3.指定序列以小写字母排序
```python 
def case_insensitive_sort(liststring):
    listtemp = [(x.lower(),x) for x in liststring]
    listtemp.sort()
    return [x[1] for x in listtemp]
```

**otb100中可能出现大小写问题的序列:**

>basketball Basketball
bolt Bolt
boy Boy
car4 Car4
carDark CarDark
carScale CarScale
coke Coke
couple Couple
crossing Crossing
david David
david2 David2
david3 David3
deer Deer
dog1 Dog1
doll Doll
dudek Dudek
faceocc1 FaceOcc1
faceocc2 FaceOcc2
fish Fish
fleetFace FleetFace
football Football
football1 Football1
freeman1 Freeman1
freeman3 Freeman3
freeman4 Freeman4
girl Girl
Human4.2 Human4-2
ironman Ironman
jogging-1 Jogging-1
jogging-2 Jogging-2
jumping Jumping
lemming Lemming
liquor Liquor
matrix Matrix
mhyang Mhyang
motorRolling MotorRolling
mountainBike MountainBike
shaking Shaking
singer1 Singer1
singer2 Singer2
skating1 Skating1
Skating2.1 Skating2-1
Skating2.2 Skating2-2
skiing Skiing
soccer Soccer
subway Subway
suv Suv
sylvester Sylvester
tiger1 Tiger1
tiger2 Tiger2
trellis Trellis
walking Walking
walking2 Walking2
woman Woman

**sed替换大小写**
`sed -i 's#basketball#Basketball#g' c.txt`
`sed -i 's#F:\\Workplace\\matlab\\Datasets\\dataset-tb100#H:\\fandeyingpan\\OTB100#g' c.txt `
`sed -i 's#basketball#Basketball#g' c.txt`

### 4.使用otb制作lasot时改图片名
```python
import glob
import os
import numpy as np
import pandas as pd
import shutil
img_dir='/root/deepTracking/tracking_datasets/lasot/LaSOT_otb/otbasket/otbasket-2/img'
imgFullnames=glob(join(img_dir,'*'))
for item in imgFullnames:
    a=item.split('/')[-1]
    b="0000"+a
    oldfilepath=join(img_dir,a)
    newfilepath=join(img_dir,b)
    os.rename(oldfilepath,newfilepath)
```

### 5.在使用otb仿制lasot时使用python制作软链接
```python
files=glob.glob('/root/deepTracking/tracking_datasets/lasot/LaSOTBenchmark/*/*')
for item in files:
    file_name=item.split('/')[-1]
    print('ln','-s',item,'/root/siamban/testing_dataset/LaSOT/'+file_name)
```

### 6.复制结果

**将跟踪得到的结果路径复制一份**

```python
import glob
import os
import numpy as np
import pandas as pd
import shutil
def cp_result(src_dir,dst_dir):
    resultfile=glob.glob('/root/deepTracking/tracking_datasets/612_test/*/*/'+src_dir+'/pos_result.txt')
    dst_path='/root/wu/trackresult/'+dst_dir
    if os.path.exists(dst_path):
        shutil.rmtree(dst_path)  # 递归删除目录
        os.mkdir(dst_path)
    else:
        os.mkdir(dst_path)
    for item in resultfile:
        file_name=item.split('/')[6]
        dst_file=os.path.join(dst_path,file_name+'.txt')
        shutil.copy(item,dst_file)
 cp_result("siamban3_result","siamban3")
```

### 7.创建文件夹

```python
if os.path.exists(path6):
    shutil.rmtree(path6)
    os.mkdir(path6)
else:
    os.mkdir(path6)
```

### 改名
```python
import os
import glob
from os.path import exists, isdir, basename, join, splitext
from glob import glob
import numpy as np

files=glob(r'D:\360MoveData\Users\whu\Desktop\DiMP_uav\*.txt')
len(files)  #123
files[0]  #'D:\\360MoveData\\Users\\whu\\Desktop\\DiMP_uav\\uav_bike1.txt'

for item in files:
    filepath,fullflname = os.path.split(item)
    fname,ext = os.path.splitext(fullflname)
    fname1=fname[4:]+'.txt'
    newname=os.path.join(filepath,fname1)
    os.rename(item,newname)
    print(item,newname)
```

```python
files=glob(r'D:\360MoveData\Users\whu\Desktop\SiamRPNpp\SiamRPN++-UAV123\SiamRPN++-UAV123\*')
files[0] #D:\\360MoveData\\Users\\whu\\Desktop\\SiamRPNpp\\SiamRPN++-UAV123\\SiamRPN++-UAV123\\bike1_SiamRPN++.mat

for item in files:
    filepath,fullflname = os.path.split(item)
    fname,ext = os.path.splitext(fullflname)
    fname1=fname[:-10]+'.mat'
    newname=os.path.join(filepath,fname1)
    print(newname)
    os.rename(item,newname)
    #print(fname,fname1)
```
```python
from os.path import exists, isdir, basename, join, splitext
from glob import glob

def get_dirs(path,fullname=True):
    all_dirs=[files for files in glob(path+'\*')]
  #  print(all_dirs)
    all_dirs.sort()
    if fullname ==True:
        return all_dirs
    else:
        all_dirnames= [basename(dir_) for dir_ in all_dirs]
        return all_dirnames
        
main_dir_atom=r'E:\MyProjects\workspace\JupyterNotebook\otb100\atom'
#print(main_dir_atom)
atom_seqnames=get_dirs(main_dir_atom,False)

def case_insensitive_sort(liststring):
    listtemp = [(x.lower(),x) for x in liststring]
    listtemp.sort()
 
    return [x[1] for x in listtemp]
atom_seqnames1=[s.lower() for s in atom_seqnames]


count=0
tmp_cot=[]
C_RPN=get_dirs('otb100/TADT',False)
#print(C_RPN)
for item in C_RPN:
    if item.lower() in atom_seqnames1:
        tmp_cot.append(item)
        src_file='otb100/ECO/'+item
        dst='otb100/ECO-1'
        print(item)
        shutil.copy(src_file,dst)
        count=count+1
print(count)
print(list(set(atom_seqnames1).difference(set([s.lower() for s in tmp_cot]))))
siampp=[files for files in glob('otb100/SiamRPNpp'+'\*')]
for item in siampp:
    a=basename(item)
    b=a.replace('+','p')
    dst_file=os.path.join('otb100/SiamRPNpp-1',b)
    print(dst_file)
    shutil.copyfile(item,dst_file)
    #print(b)
mask_dirs=[files for files in glob('otb100\mask'+'\*')]
mask_files= [basename(dir_) for dir_ in mask_dirs]

mask_files1=[]
for item in mask_files:
    a=item.split('_')[0]
    mask_files1.append(a)
mask_files2=[s.lower() for s in mask_files1]



count=0
tmp_cot=[]
C_RPN=get_dirs('otb100/SiamRPNpp',False)
C_RPN=case_insensitive_sort(C_RPN)
#print(C_RPN)
for item in C_RPN:
    if item.split('_')[0].lower() in mask_files2:
    #if item.split('_')[0].lower() == mask_files[count].split('_')[0].lower():
        
        
    
    #if item.lower() in atom_seqnames1:
        tmp_cot.append(item)
        #b=item.replace(item.split('_')[0],mask_files[count].split('_')[0])
        
        #src_file='otb100/ECO/'+item
        #dst='otb100/ECO-1'
        print(item)
       # print(b)
        #shutil.copy(src_file,dst)
    #else:
    #    print(count,item,mask_files1[count])
        count=count+1
print(count)

print(list(set(mask_files2).difference(set([s.split('_')[0].lower() for s in tmp_cot]))))
mask_files1=case_insensitive_sort(mask_files1)
mask_files=case_insensitive_sort(mask_files)
```